
@model System.Collections.Generic.IEnumerable<Easy.Register.Application.Models.Directory.DirectoryModel>
@{
    ViewBag.Title = "目录列表";
    Layout = "~/Views/Shared/MainLayout.cshtml";
}

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            目录列表
            <small>（名称，描述）</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="\"><i class="fa fa-th"></i> Home</a></li>
            <li class="active">目录列表</li>
        </ol>
    </section>
    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">目录列表</h3>
                        <div class="box-tools">
                            <div class="input-group" style="width: 150px;">
                                <input type="text" name="table_search" class="form-control input-sm pull-right" placeholder="Search">
                                <div class="input-group-btn">
                                    <button class="btn btn-sm btn-default"><i class="fa fa-search"></i></button>
                                </div>
                            </div>
                        </div>
                    </div><!-- /.box-header -->
                    <div class="box-body table-responsive no-padding">
                        <table class="table table-hover">
                            <tr>
                                <th>目录名称</th>
                                <th>API地址</th>
                                <th>版本API路径</th>
                                <th>创建时间</th>
                                <th>目录类型</th>
                                <th>描述</th>
                            </tr>
                            @foreach (var m in Model)
                            {
                                var isSelect1 = "";
                                var isSelect2 = "";
                                var isSelect3 = "";
                                switch (m.DirectoryType)
                                {
                                    case 1:
                                        isSelect1 = "selected=\"selected\"";
                                        break;
                                    case 2:
                                        isSelect2 = "selected=\"selected\"";
                                        break;
                                    case 3:
                                        isSelect3 = "selected=\"selected\"";
                                        break;
                                }

                                <tr>
                                    <td>@m.Name</td>
                                    <td><input type="text" class="form-control onPingAPIPath" id="@m.Id" value="@m.PingAPIPath" /></td>
                                    <td><input type="text" class="form-control onVersionAPIPath" id="@m.Id" value="@m.VersionAPIPath" /></td>
                                    <td>@m.CreateDate</td>
                                    <td>
                                        <select class="form-control onType" id="@m.Id">
                                            <option value="1" @isSelect1>消费者</option>
                                            <option value="2" @isSelect2>提供者</option>
                                            <option value="3" @isSelect3>消费者提供者</option>
                                        </select>
                                    </td>
                                    <td><input type="text" class="form-control onDescription" id="@m.Id" value="@m.Description" /></td>
                                </tr>
                            }
                        </table>
                    </div><!-- /.box-body -->
                </div><!-- /.box -->
            </div>
            <div class="col-xs-12">
                <div class="callout callout-success showCall">
                    <h4>Success!</h4>
                    <span id="callText"></span>
                </div>
            </div>
        </div>
    </section><!-- /.content -->
</div>

<script>
    $(function () {
        function showMsg(message) {
            $('#callText').html(message);
            $('.showCall').show(300).delay(2000).hide(300);
        }

        $('.showCall').hide();

        $('.onPingAPIPath').bind('change', function () {
            var id = $(this).attr('id');
            var val = $(this).val();
            $.post("/Directory/updatePingAPIPath/", { id: id, PingAPIPath: val }, function (data) {
                showMsg('API地址修改，操作成功！');
            });
        });

        $('.onVersionAPIPath').bind('change', function () {
            var id = $(this).attr('id');
            var val = $(this).val();
            $.post("/Directory/updateVersionAPIPath/", { id: id, VersionAPIPath: val }, function (data) {
                showMsg('版本API路径修改，操作成功！');
            });
        });

        $('.onType').bind('change', function () {
            var id = $(this).attr('id');
            var val = $(this).select().val();
            $.post("/Directory/updateType/", { id: id, Type: val }, function (data) {
                showMsg('目录类型修改，操作成功！');
            });
        });

        $('.onDescription').bind('change', function () {
            var id = $(this).attr('id');
            var val = $(this).val();
            $.post("/Directory/updateDescription/", { id: id, Description: val }, function (data) {
                showMsg('描述修改，操作成功！');
            });
        });

    });
</script>

